<div class="modalCadastra-container">
	<div class="close-button" title="Fechar" mat-dialog-close>
		<mat-icon>close</mat-icon>
	</div>
	<mat-stepper [orientation]="(stepperOrientation | async)!" [linear]="true">
		<mat-step
			label="Dados do motorista"
			state="edit"
			errorMessage="Preencha os campos obrigatórios"
			[stepControl]="_formGroupDriver"
		>
			<form [formGroup]="_formGroupDriver" autocomplete="off">
				<mat-form-field>
					<mat-label> Nome </mat-label>
					<input matInput type="text" formControlName="NomeCompleto" required />
					<mat-error *ngIf="!_formGroupDriver.hasError('required')">
						Informe o nome do motorista.
					</mat-error>
				</mat-form-field>

				<mat-form-field>
					<mat-label> CPF/CNPJ </mat-label>
					<input
						matInput
						type="text"
						formControlName="CpfCnpj"
						mask="000.000.000-00||00.000.000/0000-00"
						required
					/>
					<mat-error *ngIf="!_formGroupDriver.hasError('required')">
						Informe o CPF ou CNPJ.
					</mat-error>
				</mat-form-field>

				<mat-form-field>
					<mat-label> CNH </mat-label>
					<input
						matInput
						type="text"
						formControlName="CNH"
						mask="00000000000"
						required
					/>
					<mat-error *ngIf="!_formGroupDriver.hasError('required')">
						Informe o numero da CNH.
					</mat-error>
				</mat-form-field>

				<mat-form-field>
					<mat-label>Categoria CNH</mat-label>
					<mat-select formControlName="TipoCNH" multiple>
						<mat-option value="A"> A </mat-option>
						<mat-option value="B"> B </mat-option>
						<mat-option value="C"> C </mat-option>
						<mat-option value="D"> D </mat-option>
						<mat-option value="E"> E </mat-option>
					</mat-select>
				</mat-form-field>

				<mat-form-field>
					<mat-label>Data de vencimento</mat-label>
					<input
						matInput
						[matDatepicker]="picker"
						formControlName="dataVencimento"
					/>
					<mat-datepicker-toggle
						matSuffix
						[for]="picker"
					></mat-datepicker-toggle>
					<mat-datepicker #picker></mat-datepicker>
				</mat-form-field>

				<mat-form-field>
					<mat-label> Celular </mat-label>
					<input
						matInput
						type="text"
						formControlName="Celular"
						required
						mask="(00) 0000-0000||(00) 0 0000-0000"
					/>
					<mat-error *ngIf="!_formGroupDriver.hasError('required')">
						Informe o Celular.
					</mat-error>
				</mat-form-field>

				<div class="download-group" style="grid-column: 2">
					<mat-form-field>
						<mat-label> Foto CNH </mat-label>
						<input
							matInput
							formControlName="imagemCNH"
							placeholder="Envie uma imagem"
							[value]="fileCNH?.name || ''"
							required
							readonly
						/>
						<mat-icon matSuffix> badge </mat-icon>
					</mat-form-field>
					<input
						type="file"
						id="fileCNH"
						style="display: none"
						(change)="saveCNH($event)"
					/>
					<label for="fileCNH"> Procurar arquivo </label>
				</div>
			</form>
			<div class="controls">
				<button color="primary" mat-button mat-dialog-close>Cancelar</button>
				<button color="primary" mat-raised-button matStepperNext>
					Proximo
				</button>
			</div>
		</mat-step>
		<mat-step
			label="Dados de pagamento"
			state="attach_money"
			errorMessage="Preencha os campos obrigatórios"
			[stepControl]="_formGroupPayment"
		>
			<form [formGroup]="_formGroupPayment">
				<mat-form-field>
					<mat-label> Banco </mat-label>
					<input
						matInput
						type="text"
						[matAutocomplete]="autoBank"
						formControlName="Banco"
						(click)="getBankList()"
						required
					/>
					<mat-autocomplete #autoBank="matAutocomplete">
						<mat-option *ngFor="let bank of bankList" [value]="bank.codigo">
							{{ bank.nome }}
						</mat-option>
					</mat-autocomplete>
					<mat-error *ngIf="!_formGroupPayment.hasError('required')">
						Informe o banco do motorista
					</mat-error>
				</mat-form-field>

				<mat-form-field>
					<mat-label> Agência </mat-label>
					<input
						matInput
						type="text"
						formControlName="Agencia"
						mask="0000-0"
						required
					/>
					<mat-error *ngIf="!_formGroupPayment.hasError('required')">
						Informe a agêndia do banco
					</mat-error>
				</mat-form-field>

				<mat-form-field>
					<mat-label> Número da conta </mat-label>
					<input matInput type="text" formControlName="NumeroConta" required />
					<mat-error *ngIf="!_formGroupPayment.hasError('required')">
						Informe o número da conta
					</mat-error>
				</mat-form-field>

				<mat-form-field>
					<mat-label> PIX </mat-label>
					<mat-select formControlName="Pix">
						<mat-option value=""> Nenhum </mat-option>
						<mat-option *ngFor="let payment of paymentPix" [value]="payment">
							{{ payment }}
						</mat-option>
					</mat-select>
				</mat-form-field>

				<mat-form-field>
					<mat-label> Chave Pix </mat-label>
					<input
						matInput
						[type]="
							_formGroupPayment.controls['Pix'].value === 'E-mail'
								? 'email'
								: 'text'
						"
						formControlName="ChavePix"
						[required]="_formGroupPayment.controls['Pix'].value != ''"
						[disabled]="_formGroupPayment.controls['Pix'].value === ''"
						[mask]="
							_formGroupPayment.controls['Pix'].value === 'CPF'
								? '000.000.000-00'
								: _formGroupPayment.controls['Pix'].value === 'Telefone'
								? '(00) 0 0000-0000'
								: ''
						"
					/>
					<mat-error *ngIf="!_formGroupPayment.hasError('required')">
						Informe a chave PIX
					</mat-error>
				</mat-form-field>
			</form>
			<div class="controls">
				<button color="primary" mat-button mat-dialog-close>Cancelar</button>
				<button
					color="primary"
					mat-raised-button
					matStepperNext
					[disabled]="!_formGroupDriver.valid && !_formGroupPayment.valid"
					(click)="registerDriver()"
				>
					Proximo
				</button>
			</div>
		</mat-step>
		<mat-step label="Confirmação" state="done">
			<div class="loading-modal">
				<ng-container *ngIf="itsSaved === 0">
					<h1>Salvando informações...</h1>
					<mat-spinner color="primary"> </mat-spinner>
				</ng-container>
				<ng-container *ngIf="itsSaved === 1">
					<h1>Informações salvas com sucesso!</h1>
					<mat-icon> done </mat-icon>
				</ng-container>
				<ng-container *ngIf="itsSaved === 2">
					<h1>Ocorreu um erro ao tentar salvar.</h1>
					<h3>Por favor, tente novamente.</h3>
					<mat-icon> error </mat-icon>
				</ng-container>
				<ng-container *ngIf="itsSaved === 3">
					<h1>Motorista ja cadastrado e inativo.</h1>
					<h3>Deseja reativar esta cadastro?</h3>
					<button color="primary" mat-raised-button (click)="reactive(1)">
						Sim, quero reativar.
					</button>
					<button mat-button mat-dialog-close>Cancelar</button>
				</ng-container>
			</div>
			<div class="controls">
				<button
					color="primary"
					mat-raised-button
					*ngIf="itsSaved === 1"
					[matDialogClose]="true"
				>
					Finalizar
				</button>
			</div>
		</mat-step>
	</mat-stepper>
</div>
